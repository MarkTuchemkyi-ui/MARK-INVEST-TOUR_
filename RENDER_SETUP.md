# Настройка персистентности базы данных на Render.com

## Проблема

На Render.com файловая система **эфемерная** - это значит, что все изменения в файлах (включая базу данных SQLite) теряются при:
- Перезапуске сервиса
- Новом деплое
- Обновлении контейнера

## Решение: Использование Render Disk

Render Disk - это постоянное хранилище, которое сохраняет данные между деплоями.

## Инструкция по настройке

### Шаг 1: Создание Render Disk

1. Войдите в панель управления Render.com
2. Перейдите в раздел **Disks** (или **Volumes**)
3. Нажмите **New Disk**
4. Заполните форму:
   - **Name**: `database-disk` (или любое другое имя)
   - **Mount Path**: `/opt/render/project/src/data`
   - **Size**: минимум 1 GB (рекомендуется 2-5 GB)
5. Сохраните диск

### Шаг 2: Привязка диска к сервису

1. Перейдите в настройки вашего Web Service на Render.com
2. Найдите раздел **Disks** или **Volumes**
3. Добавьте созданный диск:
   - **Disk**: выберите `database-disk`
   - **Mount Path**: `/opt/render/project/src/data` (должен совпадать с тем, что указали при создании)

### Шаг 3: Настройка переменной окружения (опционально)

В настройках вашего Web Service на Render.com добавьте переменную окружения:

```
DB_PATH=/opt/render/project/src/data/travel.db
```

Это гарантирует, что база данных всегда будет использовать правильный путь.

### Шаг 4: Проверка

После деплоя проверьте логи сервиса. Вы должны увидеть сообщение:
```
Подключено к SQLite базе данных: /opt/render/project/src/data/travel.db
```

Если вы видите это сообщение, значит база данных использует Render Disk и данные будут сохраняться.

## Альтернативное решение: PostgreSQL

Если вы хотите использовать полноценную базу данных вместо SQLite, можно использовать PostgreSQL от Render:

1. Создайте PostgreSQL базу данных в Render
2. Установите пакет `pg` или `postgres`
3. Обновите `server/config/database.js` для работы с PostgreSQL

**Примечание**: Текущая конфигурация автоматически определяет Render Disk и использует его, если он доступен.

## Важные замечания

1. **Резервное копирование**: Регулярно делайте резервные копии базы данных, даже если используете Render Disk
2. **Размер диска**: Убедитесь, что размер диска достаточен для ваших данных
3. **Миграции**: При первом деплое после настройки Render Disk база данных будет создана автоматически

## Проверка работы

После настройки:

1. Создайте тестовую запись через админ-панель
2. Выполните деплой (перезапустите сервис)
3. Проверьте, что данные сохранились

Если данные сохранились после перезапуска - всё настроено правильно! ✅

